CREATE DATABASE parts;

USE parts;

CREATE TABLE part
(P_ID VARCHAR(20),
PNAME VARCHAR(50),
COLOUR VARCHAR(50),
WEIGHT INTEGER NOT NULL,
CITY VARCHAR(50));

CREATE TABLE project
(J_ID VARCHAR(20),
JNAME VARCHAR(50),
CITY VARCHAR(50));

CREATE TABLE supplier
(S_ID VARCHAR(20),
SNAME VARCHAR(50),
STAT INTEGER NOT NULL,
CITY VARCHAR(50));

CREATE TABLE supply
(S_ID VARCHAR(20),
P_ID VARCHAR(20),
J_ID VARCHAR(20),
QUANTITY INTEGER NOT NULL);

INSERT INTO part
(P_ID, PNAME, COLOUR, WEIGHT, CITY)
VALUES
('P1', 'NUT', 'RED', 12, 'LONDON'),
('P2', 'BOLT', 'GREEN', 17, 'PARIS'),
('P3', 'SCREW', 'BLUE', 17, 'ROME'),
('P4', 'SCREW', 'RED', 14, 'LONDON'),
('P5', 'CAM', 'BLUE', 12, 'PARIS'),
('P6', 'COG', 'RED', 19, 'LONDON');

INSERT INTO project
(J_ID, JNAME, CITY)
VALUES
('J1', 'SORTER', 'PARIS'),
('J2', 'DISPLAY', 'ROME'),
('J3', 'OCR', 'ATHENS'),
('J4', 'CONSOLE', 'ATHENS'),
('J5', 'RAID', 'LONDON'),
('J6', 'EDS', 'OSLO'),
('J7', 'TAPE', 'LONDON');

INSERT INTO supplier
(S_ID, SNAME, STAT, CITY)
VALUES
('S1', 'SMITH', 20, 'LONDON'),
('S2', 'JONES', 10, 'PARIS'),
('S3', 'BLAKE', 30, 'PARIS'),
('S4', 'CLARK', 20, 'LONDON'),
('S5', 'ADAMS', 30, 'ATHENS');

INSERT INTO supply
(S_ID, P_ID, J_ID, QUANTITY)
VALUES
('S1', 'P1', 'J1', 200),
('S1', 'P1', 'J4', 700),
('S2', 'P3', 'J1', 400),
('S2', 'P3', 'J2', 200),
('S2', 'P3', 'J3', 200),
('S2', 'P3', 'J4', 500),
('S2', 'P3', 'J5', 600),
('S2', 'P3', 'J6', 400),
('S2', 'P3', 'J7', 800),
('S2', 'P5', 'J2', 100),
('S3', 'P3', 'J1', 200),
('S3', 'P4', 'J2', 500),
('S4', 'P6', 'J3', 300),
('S4', 'P6', 'J7', 300),
('S5', 'P2', 'J2', 200),
('S5', 'P2', 'J4', 100),
('S5', 'P5', 'J5', 500),
('S5', 'P5', 'J7', 100),
('S5', 'P6', 'J2', 100),
('S5', 'P1', 'J4', 100),
('S5', 'P3', 'J4', 200),
('S5', 'P4', 'J4', 800),
('S5', 'P5', 'J4', 400),
('S5', 'P6', 'J4', 500);

SELECT * 
FROM supplier;

SELECT DISTINCT p.P_ID
FROM part p;

SELECT p.PNAME
FROM part p;

SELECT p.JNAME
FROM project p
WHERE p.CITY = 'LONDON';

USE PARTS;

SELECT p.PNAME
FROM part p
WHERE p.COLOUR = 'RED';

SELECT p.WEIGHT
FROM part p
WHERE p.COLOUR = 'RED';

USE PARTS;

SELECT DISTINCT S.SNAME
FROM SUPPLIER S
WHERE S.CITY = 'LONDON';

SELECT * FROM PART;

SELECT 
P.PNAME, P.COLOUR
FROM 
PART P
WHERE 
P.WEIGHT > 12 AND P.CITY = 'LONDON';

SELECT * FROM PART;

SELECT * 
FROM PART P
WHERE P.COLOUR = 'RED' OR
P.COLOUR = 'BLUE';

SELECT *
FROM PART P 
WHERE P.COLOUR IS NOT NULL;

USE PARTS;

-- find the name and status of each supplier who supplies project J2
SELECT
	SUPPLIER.STAT AS SUPPLIER_STATUS,
	SUPPLIER.SNAME AS SUPPLIER_NAME
FROM 
	SUPPLIER
WHERE
	SUPPLIER.S_ID IN (SELECT
		SUPPLY.S_ID
		FROM
        SUPPLY
        WHERE
        SUPPLY.J_ID = 'J2');

/* find the name and city of each project 
supplied by a London-based supplier */
SELECT * FROM PROJECT;

SELECT S.S_ID
FROM SUPPLIER S
WHERE S.CITY = 'LONDON';

SELECT
	PROJECT.JNAME,
    PROJECT.CITY
FROM 
	PROJECT
WHERE 
	PROJECT.J_ID IN (
    SELECT SUPPLY.J_ID
    FROM SUPPLY
    WHERE SUPPLY.S_ID IN (
		SELECT SUPPLIER.S_ID
		FROM SUPPLIER
		WHERE SUPPLIER.CITY = 'LONDON'
		)
    );

/*  Find the name and city of each project 
not supplied by a London-based supplier */

SELECT * FROM PROJECT;

USE PARTS;

SELECT
	PROJECT.JNAME,
    PROJECT.CITY
FROM PROJECT
WHERE PROJECT.J_ID NOT IN(
	SELECT SUPPLY.J_ID
    FROM SUPPLY
    WHERE SUPPLY.S_ID IN(
    SELECT SUPPLIER.S_ID
    FROM SUPPLIER
    WHERE SUPPLIER.CITY = 'LONDON'
    )
    );

/* find the supplier name, part name and project name for 
each case where a supplier supplies a project with a part, 
but also the supplier city, project city and part city are 
the same */

SELECT SUPPLIER.SNAME, PART.PNAME, PROJECT.JNAME
FROM SUPPLIER
INNER JOIN PART
INNER JOIN PROJECT
INNER JOIN SUPPLY
ON SUPPLIER.CITY = PART.CITY AND
PART.CITY = PROJECT.CITY AND
SUPPLIER.S_ID = SUPPLY.S_ID AND
PROJECT.J_ID = SUPPLY.J_ID AND
PART.P_ID = SUPPLY.P_ID;